; Build complete distribution
; Builds 68000 and 68020 versions

Failat 20
Delete NiKom_complete.lha
Delete Ram:NiKomDistr all

; Make the script abort if anything goes wrong during compilation
Failat 1
MakeDir Ram:NiKomDistr
MakeDir Ram:NiKomDistr/libs
MakeDir Ram:NiKomDistr/bin

cd UtilLib
smake clean
smake CPU=68000

cd /NiKomLib
smake clean
smake CPU=68000

cd /InitNiKom
smake -i clean
smake CPU=68000

cd /PreNode
smake -i clean
smake CPU=68000

cd /Server
smake -i clean
smake CPU=68000

cd /Nodes
smake -i clean
smake CPU=68000

cd /

Copy NiKomLib/NoDebug/nikom.library Ram:NiKomDistr/libs/nikom.library_68000
Copy InitNiKom/InitNiKom Ram:NiKomDistr/bin/InitNiKom_68000
Copy PreNode/NoDebug/68000/PreNode Ram:NiKomDistr/bin/PreNode_68000
Copy Server/NoDebug/68000/NiKServer Ram:NiKomDistr/bin/NiKServer_68000
Copy Nodes/NoDebug/68000/NiKomCon Ram:NiKomDistr/bin/NiKomCon_68000
Copy Nodes/NoDebug/68000/NiKomSer Ram:NiKomDistr/bin/NiKomSer_68000

cd UtilLib 
smake clean
smake

cd /NiKomLib
smake clean
smake

cd /InitNiKom  
smake -i clean 
smake

cd /PreNode    
smake -i clean 
smake

cd /Server
smake -i clean 
smake

cd /Nodes
smake -i clean 
smake

cd /
Copy NiKomLib/NoDebug/nikom.library Ram:NiKomDistr/libs/nikom.library_68020
Copy InitNiKom/InitNiKom Ram:NiKomDistr/bin/InitNiKom_68020
Copy PreNode/NoDebug/68020/PreNode Ram:NiKomDistr/bin/PreNode_68020   
Copy Server/NoDebug/68020/NiKServer Ram:NiKomDistr/bin/NiKServer_68020
Copy Nodes/NoDebug/68020/NiKomCon Ram:NiKomDistr/bin/NiKomCon_68020
Copy Nodes/NoDebug/68020/NiKomSer Ram:NiKomDistr/bin/NiKomSer_68020

Copy DistrSkeleton/#? Ram:NiKomDistr/ all

setenv nikdir `cd`
cd Ram:NiKomDistr
lha a -r "$nikdir/NiKom_full.lha" #?
cd "$nikdir"
unset nikdir
